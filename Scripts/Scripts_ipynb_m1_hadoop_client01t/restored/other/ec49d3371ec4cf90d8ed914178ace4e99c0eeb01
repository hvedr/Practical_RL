{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Кредитный скоринг заявок на основе веб-лога\n",
    "#### На основании дефолта. Ещё один подход\n",
    "2017-04-21\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "#### Config\n",
    "from pyspark import SparkConf, SparkContext, HiveContext\n",
    "import re\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import datetime\n",
    "from pyspark.mllib.regression import LabeledPoint\n",
    "from pyspark.mllib.feature import HashingTF\n",
    "from pyspark.mllib.classification import LogisticRegressionWithSGD, NaiveBayes, NaiveBayesModel\n",
    "import scipy.sparse as sps\n",
    "from pyspark.mllib.linalg import Vectors\n",
    "from pyspark.mllib.linalg import SparseVector\n",
    "from pyspark.mllib.evaluation import BinaryClassificationMetrics\n",
    "import hashlib\n",
    "from collections import Counter\n",
    "\n",
    "hive_config_query = '''\n",
    "set hive.vectorized.execution.enabled=true;\n",
    "set hive.vectorized.execution.reduce.enabled = true;\n",
    "set mapreduce.map.memory.mb=4096;\n",
    "set mapreduce.map.child.java.opts=-Xmx4g;\n",
    "set mapreduce.task.io.sort.mb=1024;\n",
    "set mapreduce.reduce.child.java.opts=-Xmx4g;\n",
    "set mapreduce.reduce.memory.mb=7000;\n",
    "set mapreduce.reduce.shuffle.input.buffer.percent=0.5;\n",
    "set mapreduce.input.fileinputformat.split.minsize=536870912;\n",
    "set mapreduce.input.fileinputformat.split.maxsize=1073741824;\n",
    "set hive.optimize.ppd=true;\n",
    "set hive.merge.smallfiles.avgsize=536870912;\n",
    "set hive.merge.mapredfiles=true;\n",
    "set hive.merge.mapfiles=true;\n",
    "set hive.hadoop.supports.splittable.combineinputformat=true;\n",
    "set hive.exec.reducers.bytes.per.reducer=536870912;\n",
    "set hive.exec.parallel=true;\n",
    "set hive.exec.max.created.files=10000000;\n",
    "set hive.exec.compress.output=true;\n",
    "set hive.exec.dynamic.partition.mode=nonstrict;\n",
    "set hive.exec.max.dynamic.partitions=1000000;\n",
    "set hive.exec.max.dynamic.partitions.pernode=100000;\n",
    "set io.seqfile.compression.type=BLOCK;\n",
    "set mapreduce.map.failures.maxpercent=5;\n",
    "'''\n",
    "try:\n",
    "    sc.stop()\n",
    "except NameError:\n",
    "    pass\n",
    "conf = (SparkConf()\n",
    "        .set(\"spark.executor.instances\", 8)\n",
    "        .set(\"spark.driver.maxResultSize\", \"16g\")\n",
    "        .set(\"spark.executor.memory\", '16g')\n",
    "        .set(\"spark.yarn.executor.memoryOverhead\", 4048)      \n",
    "        .set('spark.akka.frameSize',2040)\n",
    "       )\n",
    "sc = SparkContext(conf=conf)    \n",
    "hc = HiveContext(sc)\n",
    "\n",
    "for q in hive_config_query.split(';'):\n",
    "    try:\n",
    "        hc.sql(q)\n",
    "    except:\n",
    "        pass"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "# In case sparkcontext doesn't work, use following (remove --driver-memory 4g string):\n",
    "#import os\n",
    "#os.environ['PYSPARK_SUBMIT_ARGS'] = '''\n",
    "#--master yarn --deploy-mode client --num-executors 2 --executor-memory 8g --executor-cores 1 --conf spark.yarn.queue=kposminin\n",
    "#  pyspark-shell\n",
    "#'''"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "from sklearn import datasets, metrics, model_selection\n",
    "from pylightgbm.models import GBMClassifier\n",
    "\n",
    "# full path to lightgbm executable (on Windows include .exe)\n",
    "exec_path = \"lightgbm\"\n",
    "\n",
    "import sklearn.model_selection\n",
    "import os\n",
    "\n",
    "os.environ[\"LIGHTGBM_EXEC\"] = exec_path"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "start_date = datetime.date(2016,12,31)\n",
    "\n",
    "for d in dates_to_calc_2016:\n",
    "    #date = str(start_date - datetime.timedelta(days = i))\n",
    "    #if (not date in calced_dates):\n",
    "    print(feature_visits_pattern.replace('#visit_ymd', d))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Генерация факторов\n",
    "##### Я.Каталог"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "#a = train_data1.take(100)\n",
    "#l = a[0][1]\n",
    "#[e[0] for e in l]\n",
    "#zip([list(l)[[e[0] for e in l].index(i)][1] if i in [e[0] for e in l] else 0 for i in range(420)],range(500))\n",
    "a= (hc.sql(select_query)\n",
    "                .filter(\"call_ymd < '2016-06-15'\")\n",
    "                .rdd\n",
    "                .map(lambda r: ((r.phone_mobile,r.call_ymd,r.default_flg),r[3:]))\n",
    "                .groupByKey()\n",
    "                .take(10)\n",
    "   )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "train_data = (hc.sql(select_query)\n",
    "                .filter(\"call_ymd < '2016-06-15'\")\n",
    "                .rdd\n",
    "                .map(lambda r: ((r.phone_mobile,r.call_ymd,r.default_flg),r[3:]))\n",
    "                .groupByKey()\n",
    "                .map(lambda (k,l):(k,[list(l)[[e[0] for e in l].index(i)][1] if i in [e[0] for e in l] else 0 for i in range(420)] + \n",
    "                                     [list(l)[[e[0] for e in l].index(i)][2] if i in [e[0] for e in l] else 0 for i in range(420)] +\n",
    "                                     [list(l)[[e[0] for e in l].index(i)][3] if i in [e[0] for e in l] else 0 for i in range(420)] + \n",
    "                                     [list(l)[[e[0] for e in l].index(i)][4] if i in [e[0] for e in l] else 0 for i in range(420)] + \n",
    "                                     list(list(l)[0][5:])))\n",
    "                .collect() \n",
    "             )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "test_data = (hc.sql(select_query)\n",
    "                .filter(\"call_ymd >= '2016-06-15'\")\n",
    "                .rdd\n",
    "                .map(lambda r: ((r.phone_mobile,r.call_ymd,r.default_flg),r[3:]))\n",
    "                .groupByKey()\n",
    "                .map(lambda (k,l):(k,[list(l)[[e[0] for e in l].index(i)][1] if i in [e[0] for e in l] else 0 for i in range(420)] + \n",
    "                                     [list(l)[[e[0] for e in l].index(i)][2] if i in [e[0] for e in l] else 0 for i in range(420)] +\n",
    "                                     [list(l)[[e[0] for e in l].index(i)][3] if i in [e[0] for e in l] else 0 for i in range(420)] + \n",
    "                                     [list(l)[[e[0] for e in l].index(i)][4] if i in [e[0] for e in l] else 0 for i in range(420)] + \n",
    "                                     list(list(l)[0][5:])))\n",
    "                .collect() \n",
    "             )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "import xgboost as xgb\n",
    "dtrain = xgb.DMatrix( [e[1] for e in train_data], label = [e[0][2] for e in train_data])\n",
    "dtest  = xgb.DMatrix( [e[1] for e in test_data],  label = [e[0][2] for e in test_data] )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "#train_data[12] '+79678813486', u'2016-01-25'\n",
    "#dtest.get_label().mean()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "#X, Y = datasets.make_classification(n_samples=200, n_features=10)\n",
    "#x_train, x_test, y_train, y_test = model_selection.train_test_split(X, Y, test_size=0.2)\n",
    "\n",
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf=5,\n",
    "        is_unbalance = True,\n",
    "        num_iterations = 500,\n",
    "        bagging_fraction = 0.8,\n",
    "        bagging_freq = 5,\n",
    "        metric = 'auc',\n",
    "        early_stopping_round=10\n",
    ")\n",
    "\n",
    "x_train, y_train, x_test, y_test = [e[1] for e in train_data],[e[0][2] for e in train_data], [e[1] for e in test_data],[e[0][2] for e in test_data]\n",
    "\n",
    "clf.fit( x_train, y_train, test_data=[(x_test, y_test)])\n",
    "y_test_pred = clf.predict(np.array(x_test))\n",
    "print(\"Accuracy: \", metrics.accuracy_score(y_test, y_test_pred))\n",
    "print('AUC ROC:  ',metrics.roc_auc_score(y_test, y_test_pred))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "y_test_pred = clf.predict(np.array(x_test))\n",
    "print(\"Accuracy: \", metrics.accuracy_score(y_test, y_test_pred))\n",
    "print('AUC ROC:  ',metrics.roc_auc_score(y_test, y_test_pred))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### На всех фичах AUC 0.538, что плохо."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Скорим урлфрагменты на основе default_flg"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "query = '''\n",
    "-- скор урла - логарифм регуляризованного отношения кол-ва уникальных положительных посетителей к отрицательным посетителям.\n",
    "-- таких несколько партиций с интервалом в 3 месяца\n",
    "insert overwrite table user_kposminin.urlfr_tgt_cnt partition (ymd, target)\n",
    "select \n",
    "  urlfr,\n",
    "  cnt_positive,\n",
    "  cnt_total,\n",
    "  log((cnt_positive + 0.1) / (cnt_total - cnt_positive + 0.1)) as score,\n",
    "  ymd,\n",
    "  target\n",
    "from(\n",
    " select\n",
    "   urlfr,\n",
    "   count(distinct if(default_flg = 1, concat(phone_mobile, call_ymd), Null)) as  cnt_positive,\n",
    "   count(distinct concat(phone_mobile, call_ymd)) as cnt_total,\n",
    "   '2016-06-01' as ymd,\n",
    "   'tinkoff_LON_CCR_default' as target\n",
    " from \n",
    "   user_kposminin.cred_app_visits\n",
    " where\n",
    "   (not default_flg is Null)\n",
    "   and call_ymd < '2016-06-01'\n",
    " group by urlfr\n",
    " ) a\n",
    ";\n",
    "\n",
    "-- Генерация фичей на основе этого скоринга. Шаг 1/4.\n",
    "create table user_kposminin.cred_app_sc_1_1 as\n",
    "select \n",
    "  phone_mobile\n",
    "  ,call_ymd\n",
    "  ,max(default_flg) as default_flg\n",
    "  ,v.urlfr\n",
    "  ,v.ymd\n",
    "  ,max(\n",
    "    named_struct(\n",
    "      'ymd', v.ymd,\n",
    "      'score', if(t.ymd < v.ymd,t.score, -10)\n",
    "    )\n",
    "   ).score as score\n",
    "  ,max(  id_cnt ) as id_cnt\n",
    "  ,max(  load_src_cnt ) as   load_src_cnt \n",
    "  ,max(  cnt ) as   cnt \n",
    "  ,max(  first_visit ) as   first_visit \n",
    "  ,max(  duration ) as   duration \n",
    "  ,max(  avg_hour ) as   avg_hour \n",
    "  ,max(  load_dttm ) as   load_dttm \n",
    "  ,max(  financial_product_type_cd ) as   financial_product_type_cd\n",
    "  ,(unix_timestamp(max(v.call_ymd), 'yyyy-MM-dd') - unix_timestamp(min(v.ymd), 'yyyy-MM-dd'))/60/60/24 as lag\n",
    "from \n",
    "  user_kposminin.cred_app_visits v\n",
    "  left join user_kposminin.urlfr_tgt_cnt t on t.urlfr = v.urlfr\n",
    "group by\n",
    "  v.phone_mobile, \n",
    "  v.call_ymd,\n",
    "  v.ymd,\n",
    "  v.urlfr\n",
    ";\n",
    "\n",
    "\n",
    "set hive.tez.auto.reducer.parallelism=true;\n",
    "\n",
    "set hive.tez.min.partition.factor=0.25;\n",
    "set hive.tez.max.partition.factor=2.0;\n",
    "set tez.runtime.pipelined.sorter.lazy-allocate.memory=true;\n",
    "set hive.exec.reducers.bytes.per.reducer=67108864;\n",
    "\n",
    "\n",
    "-- Генерация фичей на основе этого скоринга. Шаг 2/4.\n",
    "create table user_kposminin.cred_app_sc_2 as\n",
    "select \n",
    "  phone_mobile, \n",
    "  call_ymd, \n",
    "  max(default_flg) as default_flg,\n",
    "  (unix_timestamp(max(ymd), 'yyyy-MM-dd') - unix_timestamp(min(ymd), 'yyyy-MM-dd'))/60/60/24 as ymd_range,\n",
    "  stddev(unix_timestamp(ymd, 'yyyy-MM-dd')/60/60 + avg_hour) as time_std,\n",
    "  count(distinct ymd) as ymd_cnt,\n",
    "  max(id_cnt) as id_cnt,\n",
    "  max(load_src_cnt) as load_src_cnt,\n",
    "  avg(avg_hour) as avg_hour,\n",
    "  percentile_approx(avg_hour,array(0.1,0.5,0.9)) as avg_hour_q_arr,\n",
    "  count(*) as cnt,\n",
    "  sum(cnt) as hits,\n",
    "  avg(cnt) as avg_hits,\n",
    "  avg(duration) as avg_duration,\n",
    "  percentile_approx(duration,0.1) as duration_q10,\n",
    "  percentile_approx(duration,0.9) as duration_q90,\n",
    "  min(first_visit) as min_first_visit,\n",
    "  avg(first_visit) as avg_first_visit,\n",
    "  max(if(financial_product_type_cd = 'CCR',1,0)) as CCR,\n",
    "  max(score) as max_score,\n",
    "  avg(score) as avg_score,\n",
    "  max(score * ( - log(lag + 1))) as max_w_score,\n",
    "  avg(if(score > -2.5, avg_hour,Null)) as avg_good_hour,\n",
    "  sum(if(regexp_extract(urlfr, '\\.([^.#]*)#', 1) in ('ru','com','org'),1,0))/sum(1) as ru_com_share,\n",
    "  sum(if(urlfr like 'e.mail.ru%',1,0))/sum(1) as emailru_share,\n",
    "  sum(if(urlfr like 'm.%',1,0))/sum(1) as mobile_share,\n",
    "  sum(if(urlfr rlike '^(m\\\\.)?vk.com%', 1, 0))/sum(1) as vk_share,\n",
    "  sum(if(urlfr like 'vk.com%' or urlfr rlike '^(m\\\\.)?ok\\\\.ru' or urlfr like 'm.odnoklassniki.ru%' or urlfr rlike '^(m\\\\.)?my.mail.ru',1,0))/sum(1) as social_share,\n",
    "  count(distinct urlfr) as urlfr_cnt    \n",
    "from \n",
    "  user_kposminin.cred_app_sc_1_1\n",
    "group by\n",
    "  phone_mobile, \n",
    "  call_ymd\n",
    ";\n",
    "\n",
    "\n",
    "-- Генерация фичей на основе этого скоринга. Шаг 3/4.\n",
    "create table user_kposminin.cred_app_sc_3 as\n",
    "select \n",
    "  phone_mobile, \n",
    "  call_ymd,\n",
    "  percentile_approx(score * ( - log(lag + 1)), array(0.1,0.3,0.5,0.7,0.8,0.9,0.98)) as w_score_q_arr,\n",
    "  percentile_approx(score, array(0.1,0.3,0.5,0.7,0.8,0.9,0.98)) as score_q_arr\n",
    "from \n",
    "  user_kposminin.cred_app_sc_1_1\n",
    "group by\n",
    "  phone_mobile, \n",
    "  call_ymd\n",
    ";\n",
    "\n",
    "-- Генерация фичей на основе этого скоринга. Шаг 4/4.\n",
    "create table user_kposminin.cred_app_sc_4 as\n",
    "select \n",
    "  a.*,\n",
    "  b.w_score_q_arr,\n",
    "  b.score_q_arr\n",
    "from \n",
    "  user_kposminin.cred_app_sc_2 a\n",
    "  left join user_kposminin.cred_app_sc_3 b on a.phone_mobile = b.phone_mobile and  a.call_ymd = b.call_ymd\n",
    ";\n",
    "\n",
    "\n",
    "'''\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "cols = ['phone_mobile','call_ymd','default_flg','ymd_range','time_std','ymd_cnt','id_cnt','load_src_cnt',\n",
    "        'avg_hour','avg_hour_q10','avg_hour_q50','avg_hour_q90','cnt','hits','avg_hits','avg_duration',\n",
    "        'duration_q10','duration_q90',\n",
    "        'min_first_visit','avg_first_visit','ccr','max_score','avg_score','max_w_score','avg_good_hour',\n",
    "        'ru_com_share','emailru_share','mobile_share','vk_share','social_share','urlfr_cnt',\n",
    "        'wscore_q10','wscore_q30','wscore_q50','wscore_q70','wscore_q80','wscore_q90','wscore_q98',\n",
    "        'score_q10','score_q30','score_q50','score_q70','score_q80','score_q90','score_q98']"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Выборки"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "\n",
    "df_train = (\n",
    "      hc.sql('select * from user_kposminin.cred_app_sc_4')\n",
    "        .filter('call_ymd <= \"2016-06-01\"')\n",
    "        .filter('not default_flg is Null')\n",
    "        .map(lambda r: \n",
    "                list(r[:9]) + (r[9] if r[9] else []) + list(r[10:-2])  + (r[-2] if r[-2] else []) + (r[-1] if r[-1] else [])\n",
    "            )\n",
    "        .toDF()\n",
    "        .toPandas()\n",
    "    )\n",
    "df_train.columns = cols\n",
    "feat_cols = [c for c in df_train.columns if not c in (u'phone_mobile', u'call_ymd', u'default_flg',\n",
    "                                                      u'min_first_visit',u'avg_first_visit')]\n",
    "    \n",
    "df_test = (\n",
    "      hc.sql('select * from user_kposminin.cred_app_sc_4')\n",
    "        .filter('call_ymd > \"2016-06-01\"')\n",
    "        .filter('not default_flg is Null')\n",
    "        .map(lambda r: \n",
    "                list(r[:9]) + (r[9] if r[9] else []) + list(r[10:-2])  + (r[-2] if r[-2] else []) + (r[-1] if r[-1] else [])\n",
    "            )\n",
    "        .toDF()\n",
    "        .toPandas()\n",
    "    )\n",
    "df_test.columns = cols\n",
    "label = 'default_flg'"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Базовый классификатор"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "from sklearn import datasets, metrics, model_selection\n",
    "from pylightgbm.models import GBMClassifier\n",
    "\n",
    "# full path to lightgbm executable (on Windows include .exe)\n",
    "exec_path = \"/usr/bin/lightgbm\"\n",
    "\n",
    "#X, Y = datasets.make_classification(n_samples=200, n_features=10)\n",
    "#x_train, x_test, y_train, y_test = model_selection.train_test_split(X, Y, test_size=0.2)\n",
    "\n",
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf=10,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 200,\n",
    "        bagging_fraction = 0.8,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 127,\n",
    "        metric = 'auc',\n",
    "        early_stopping_round=10\n",
    ")\n",
    "\n",
    "#clf.fit(df_train[feat_cols], df_train[label], test_data = [(df_test[feat_cols], df_test[label])])\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "collapsed": false
   },
   "source": [
    "[LightGBM] [Info] Iteration:47, valid_1 auc : 0.621389 - на тесте"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf=10,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 200,\n",
    "        bagging_fraction = 0.8,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 127,\n",
    "        metric = 'auc',\n",
    "        early_stopping_round=10,\n",
    "        verbose = False\n",
    ")\n",
    "\n",
    "r = cv(clf, df_train[feat_cols].values, df_train[label].values, folds = 5)\n",
    "r"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "np.mean(r['roc_auc'])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "collapsed": true
   },
   "source": [
    "#### Базовый классификатор дает 0.621389 - на тесте и 0.571297 на кросс-валидации. Тот же диспартитет будем наблюдать и дальше."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "collapsed": true
   },
   "source": [
    "### Важность факторов"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "% matplotlib inline\n",
    "feat_imp = pd.DataFrame([(feat_cols[k],v) for k,v in clf.feature_importance().items()]) #.sort_values(ascending=False)\n",
    "feat_imp.index = feat_imp[0]\n",
    "feat_imp = feat_imp.sort(1, ascending = False)[1]\n",
    "feat_imp"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "import sklearn\n",
    "\n",
    "#print(\"Features as classifiers: AUC ROC on test. \")\n",
    "features_performance = [(\n",
    "        f,\n",
    "        sklearn.metrics.roc_auc_score(y_true = df_train[label],y_score = df_train[f].fillna(-1000)),\n",
    "        sklearn.metrics.average_precision_score(y_true = df_train[label],y_score = df_train[f].fillna(-1000)),\n",
    "    ) for f in feat_cols]\n",
    "print('Feature standalone performace\\n{:<30}  {:<15}  {:<15}\\n'.format('Feature','Train AUC ROC','Train AUC PR') + \n",
    "    '\\n'.join('{:<30}  {:<15.4f}  {:<15.4f}'.format(*e) for e in sorted(features_performance, key = lambda e: -e[1])))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### CV Param selection"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "def cv(clf, X, y, folds = 5, metrics = 'roc_auc,pr_auc', predict = False):\n",
    "    '''calc cross-validation metrics for clf classfier (actually LightGBM classifier) on X,y data.\n",
    "       In case predict == True, additionally returns cv proba predictions.'''\n",
    "    assert X.shape[0] == len(y), 'X and y lengths doesnt match'\n",
    "    idx = range(X.shape[0])\n",
    "    np.random.shuffle(idx)\n",
    "    fold_idx = []\n",
    "    if predict:\n",
    "        y_pred = np.zeros(len(idx))\n",
    "    \n",
    "    for i in range(folds):\n",
    "        fold_idx.append(idx[i*len(idx)/folds:(i+1)*len(idx)/folds])\n",
    "    res = {k:[] for k in metrics.split(',')}\n",
    "    \n",
    "    for i in range(folds):\n",
    "        train_idx = reduce(lambda x,y: x + y, (fold_idx[:i] + fold_idx[(i+1):]))\n",
    "        valid_idx = fold_idx[i]\n",
    "        \n",
    "        clf.fit(X[train_idx],y[train_idx])\n",
    "        valid_pred = clf.predict_proba(X[valid_idx])[:,1]\n",
    "        if predict:\n",
    "            for j in range(len(valid_idx)):\n",
    "                y_pred[valid_idx[j]] = valid_pred[j]\n",
    "        \n",
    "        if('roc_auc' in metrics):\n",
    "            res['roc_auc'].append(\n",
    "                sklearn.metrics.roc_auc_score(\n",
    "                  y_true = y[valid_idx],\n",
    "                  y_score = valid_pred\n",
    "                )\n",
    "            )\n",
    "        if('pr_auc' in metrics):\n",
    "            res['pr_auc'].append(\n",
    "                sklearn.metrics.average_precision_score(\n",
    "                  y_true = y[valid_idx],\n",
    "                  y_score = valid_pred\n",
    "                )\n",
    "            )\n",
    "            \n",
    "    if predict:\n",
    "        return res, y_pred\n",
    "    else:\n",
    "        return res"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "# Set high learning rate. Find optimum trees num\n",
    "\n",
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 50,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 200,\n",
    "        bagging_fraction = 0.8,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 63,\n",
    "        learning_rate = 0.1,\n",
    "        metric = 'auc',\n",
    "        verbose=False\n",
    "    )\n",
    "\n",
    "    \n",
    "param_grid = {\n",
    "    'num_iterations': [30,70,100,150,200,300,500]\n",
    "\n",
    "}\n",
    "\n",
    "ngrid = 7\n",
    "grid_search = sklearn.model_selection.RandomizedSearchCV(clf, param_distributions=param_grid,\n",
    "                                   n_iter=ngrid,cv=5,scoring='roc_auc')\n",
    "\n",
    "grid_search.fit(df_train[feat_cols], df_train[label])\n",
    "grid_search.grid_scores_"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Selected learning_rate = 0.1,num_iterations = 70;"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "df_train.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "# Set high learning rate. Find optimum trees num\n",
    "\n",
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 50,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 70,\n",
    "        bagging_fraction = 0.8,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 63,\n",
    "        learning_rate = 0.1,\n",
    "        metric = 'auc',\n",
    "        verbose=False\n",
    "    )\n",
    "\n",
    "    \n",
    "param_grid = {\n",
    "    'min_data_in_leaf': [10,50,100,200,500],\n",
    "    'num_leaves': [15,31,63,127,255],\n",
    "    'bagging_fraction': [0.5,0.8, 1],\n",
    "    'bagging_freq': [5,10,30],\n",
    "    'feature_fraction': [0.5, 0.8, 1]\n",
    "}\n",
    "\n",
    "   \n",
    "n_iter = 60\n",
    "\n",
    "grid_search = sklearn.model_selection.RandomizedSearchCV(clf, param_distributions=param_grid,\n",
    "                                   n_iter = n_iter, cv = 5,scoring='roc_auc')\n",
    "\n",
    "grid_search.fit(df_train[feat_cols], df_train[label])\n",
    "grid_search.grid_scores_\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### selected params:\n",
    "mean\t0.61121\t std\t0.01024\t params\t {'num_leaves'\t15\t 'bagging_fraction'\t1\t 'bagging_freq'\t5\t 'min_data_in_leaf'\t100\t 'feature_fraction'\t 0.8}\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 100,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 70,\n",
    "        bagging_fraction = 1,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 15,\n",
    "        learning_rate = 0.1,\n",
    "        feature_fraction = 0.8,\n",
    "        metric = 'auc',\n",
    "        verbose=False\n",
    "    )\n",
    "\n",
    "param_set = (\n",
    "    {'learning_rate':0.1, 'num_iterations':50, 'num_leaves':15},\n",
    "    {'learning_rate':0.1, 'num_iterations':70, 'num_leaves':15},\n",
    "    {'learning_rate':0.08, 'num_iterations':100, 'num_leaves':15},\n",
    "    {'learning_rate':0.08, 'num_iterations':100, 'num_leaves':31},\n",
    "    {'learning_rate':0.06, 'num_iterations':150, 'num_leaves':31},\n",
    "    {'learning_rate':0.06, 'num_iterations':150, 'num_leaves':15},\n",
    "    {'learning_rate':0.05, 'num_iterations':200, 'num_leaves':31},\n",
    "    {'learning_rate':0.04, 'num_iterations':200, 'num_leaves':63},\n",
    "    {'learning_rate':0.04, 'num_iterations':300, 'num_leaves':63},\n",
    "    {'learning_rate':0.03, 'num_iterations':400, 'num_leaves':31},\n",
    "    {'learning_rate':0.05, 'num_iterations':300, 'num_leaves':31},\n",
    ")\n",
    "\n",
    "\n",
    "#n_iter = 60\n",
    "res= []\n",
    "for param in param_set:\n",
    "    clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 100,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = param['num_iterations'],\n",
    "        bagging_fraction = 1,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = param['num_iterations'],\n",
    "        learning_rate = param['learning_rate'],\n",
    "        feature_fraction = 0.8,\n",
    "        metric = 'auc',\n",
    "        verbose=False\n",
    "    )\n",
    "    \n",
    "    res.append((param,cv(clf, df_train[feat_cols].values, df_train[label].values, folds = 5, metrics = 'roc_auc,pr_auc')))\n",
    "\n",
    "res"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false,
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "df_res = pd.DataFrame([(k,v['pr_auc'],v['roc_auc']) for (k,v) in res],\n",
    "                      columns = ['feats','cv_pr','cv_roc'])\n",
    "df_res['avg_roc'] = df_res['cv_roc'].map(lambda l: sum(l)/len(l))\n",
    "df_res['std_roc'] = df_res['cv_roc'].map(lambda l: np.std(l))\n",
    "df_res['min_roc'] = df_res['cv_roc'].map(lambda l: min(l))\n",
    "df_res['max_roc'] = df_res['cv_roc'].map(lambda l: max(l))\n",
    "df_res['avg_pr'] = df_res['cv_pr'].map(lambda l: sum(l)/len(l))\n",
    "df_res['std_pr'] = df_res['cv_pr'].map(lambda l: np.std(l))\n",
    "df_res['min_pr'] = df_res['cv_pr'].map(lambda l: min(l))\n",
    "df_res['max_pr'] = df_res['cv_pr'].map(lambda l: max(l))\n",
    "df_res['feats_len'] = df_res['feats'].map(lambda l: len(l))\n",
    "df_res"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "df_res.loc[0]['feats']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.869284 seconds\n",
      "[LightGBM] [Info] Number of positive: 6220, number of negative: 101699\n",
      "[LightGBM] [Info] Total Bins 8552\n",
      "[LightGBM] [Info] Number of data: 107919, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.027577 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.054331 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.081986 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.107668 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.135394 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.164970 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.196285 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.226468 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.253284 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.283521 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.311179 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.340786 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.367111 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.398980 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.425120 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.453843 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.481930 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.508422 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.539045 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.567567 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.597723 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.630713 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.657407 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.686545 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.713773 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.740661 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.767565 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.795864 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.824703 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.852469 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.880935 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.908435 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.937388 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.963183 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.986681 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.013303 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.046815 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.074245 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.097457 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.127665 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.158250 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.184723 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.214176 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.239976 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.266013 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.297449 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] 1.318995 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.345479 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.366489 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.389950 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.413703 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.439075 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.464620 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.489267 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.510879 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] 1.532148 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.555364 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.580035 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.602404 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.625753 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.645275 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.668761 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.686607 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.709271 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.730218 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.752463 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.773473 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.797176 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.817583 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.838486 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.879385 seconds\n",
      "[LightGBM] [Info] Number of positive: 6260, number of negative: 101658\n",
      "[LightGBM] [Info] Total Bins 8547\n",
      "[LightGBM] [Info] Number of data: 107918, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.031037 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.059521 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.086155 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.113642 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.140258 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.168785 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.194305 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.221403 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.249717 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.278859 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.305387 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.333962 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.360242 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.388259 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.414715 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.444688 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.470751 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.498987 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.526542 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.555117 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.581454 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.608784 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.634790 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.664076 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.691077 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.717556 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.744951 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.772591 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.799610 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.826220 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.851913 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.879013 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.904428 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.932786 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.957645 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.984066 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.009925 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.033423 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.060450 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.085982 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.112771 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.137109 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.159216 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.185630 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.211653 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.236576 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.259697 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.285563 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=12\n",
      "[LightGBM] [Info] 1.309485 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.329613 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] 1.349053 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.372167 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.395336 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.418111 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.440997 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.458957 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.479184 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.502556 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.522956 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.543943 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.567256 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.590571 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.614361 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.633132 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.653538 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.674806 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.690605 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.706333 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.730577 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.748920 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.945843 seconds\n",
      "[LightGBM] [Info] Number of positive: 6289, number of negative: 101630\n",
      "[LightGBM] [Info] Total Bins 8555\n",
      "[LightGBM] [Info] Number of data: 107919, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.028693 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.058792 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.087430 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.118344 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.145541 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.175798 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.204980 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.236311 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.262380 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.291499 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.319986 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.350853 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.377933 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.406790 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.435023 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.463862 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.492885 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.521915 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.550131 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.578897 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.606948 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.639924 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.671900 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.702308 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.734445 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.760323 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.792738 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.820838 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.850255 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.882831 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.911936 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.943585 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.972892 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.007688 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.038212 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.067460 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.095422 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.128679 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.163351 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.191953 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.224629 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.252236 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.278275 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.305227 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.332634 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.361126 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.386329 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.413586 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.439935 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.464493 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.485811 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.515477 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.547490 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.577391 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.608064 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] 1.632698 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.653066 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.679164 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.703804 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.720419 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.739216 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.766151 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.793804 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.815465 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] 1.838584 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.860488 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.881821 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.899218 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.920878 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.939067 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.907895 seconds\n",
      "[LightGBM] [Info] Number of positive: 6227, number of negative: 101691\n",
      "[LightGBM] [Info] Total Bins 8551\n",
      "[LightGBM] [Info] Number of data: 107918, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.029427 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.058188 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.087081 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.116256 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.151204 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.181765 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.212435 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.244887 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.270946 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.300065 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.326858 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.355279 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.383390 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.410410 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.436858 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.466194 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.493458 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.521073 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.551937 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.581752 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.609280 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.637024 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.663937 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.692679 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.720236 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.747264 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.774577 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.802033 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.828838 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.856845 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.882278 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.908881 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.935854 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.964140 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.991247 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.017166 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.041462 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.072253 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.097062 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.122162 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.150279 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.176577 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.202162 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.228720 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.254437 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.276846 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.299705 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.326119 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.351989 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.375344 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.398941 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.437379 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.461751 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.485326 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.507112 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.524525 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.550297 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.571711 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.591035 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.614711 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.638439 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.660298 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.681903 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.702734 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.723507 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.741173 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.761748 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.780947 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.798186 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.813819 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.899178 seconds\n",
      "[LightGBM] [Info] Number of positive: 6284, number of negative: 101634\n",
      "[LightGBM] [Info] Total Bins 8549\n",
      "[LightGBM] [Info] Number of data: 107918, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.029308 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.058120 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.086108 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.114757 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.140333 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.169570 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.196228 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.225729 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.252016 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.281168 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.308471 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.337292 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.364691 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.394776 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.422301 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.453183 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.481541 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.510529 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.538315 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.566987 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.595347 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.624924 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.654173 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.683976 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] 0.710885 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.738340 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.771614 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.809275 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.845013 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.873919 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.900574 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.930161 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.955855 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.982895 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.007956 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.032349 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.058587 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.082439 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.110623 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.139393 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.168608 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.194789 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.222225 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.246348 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.279187 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.308259 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.341860 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.371575 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.400167 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.428325 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.454523 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.481880 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.509440 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.533608 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.557953 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.588463 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.610744 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.637484 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.666096 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.690420 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=12\n",
      "[LightGBM] [Info] 1.715120 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.734416 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.764326 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.789282 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.807575 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.827470 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.853453 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.873496 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.893316 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.916137 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "CV AUC ROC 0.609150048242; AUC PR 0.0855605495408\n"
     ]
    }
   ],
   "source": [
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 100,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 70,\n",
    "        bagging_fraction = 1,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 15,\n",
    "        learning_rate = 0.1,\n",
    "        metric = 'auc',\n",
    "        feature_fraction = 0.8,\n",
    "    )\n",
    "\n",
    "#mean 0.61121 std 0.01024 params {'num_leaves' 15 'bagging_fraction' 1 'bagging_freq' 5 'min_data_in_leaf' 100 'feature_fraction' 0.8}\n",
    "r = cv(clf, df_train[feat_cols].values, df_train[label].values, folds = 5, metrics = 'roc_auc,pr_auc')\n",
    "print('CV AUC ROC {}; AUC PR {}'.format(np.mean(r['roc_auc']),np.mean(r['pr_auc'])))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 2.740161 seconds\n",
      "[LightGBM] [Info] Number of positive: 7820, number of negative: 127078\n",
      "[LightGBM] [Info] Total Bins 8592\n",
      "[LightGBM] [Info] Number of data: 134898, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:1, valid_1 auc : 0.593282\n",
      "[LightGBM] [Info] 0.040203 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:2, valid_1 auc : 0.597723\n",
      "[LightGBM] [Info] 0.078810 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:3, valid_1 auc : 0.597559\n",
      "[LightGBM] [Info] 0.114605 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:4, valid_1 auc : 0.600037\n",
      "[LightGBM] [Info] 0.155810 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:5, valid_1 auc : 0.601017\n",
      "[LightGBM] [Info] 0.194228 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] Iteration:6, valid_1 auc : 0.603739\n",
      "[LightGBM] [Info] 0.234776 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:7, valid_1 auc : 0.605273\n",
      "[LightGBM] [Info] 0.274328 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:8, valid_1 auc : 0.606237\n",
      "[LightGBM] [Info] 0.315520 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:9, valid_1 auc : 0.607284\n",
      "[LightGBM] [Info] 0.352506 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:10, valid_1 auc : 0.607394\n",
      "[LightGBM] [Info] 0.393678 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:11, valid_1 auc : 0.60939\n",
      "[LightGBM] [Info] 0.435300 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:12, valid_1 auc : 0.609885\n",
      "[LightGBM] [Info] 0.475492 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:13, valid_1 auc : 0.610103\n",
      "[LightGBM] [Info] 0.513773 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] Iteration:14, valid_1 auc : 0.60938\n",
      "[LightGBM] [Info] 0.554712 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] Iteration:15, valid_1 auc : 0.608707\n",
      "[LightGBM] [Info] 0.593349 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:16, valid_1 auc : 0.610518\n",
      "[LightGBM] [Info] 0.633922 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:17, valid_1 auc : 0.610657\n",
      "[LightGBM] [Info] 0.674553 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:18, valid_1 auc : 0.609615\n",
      "[LightGBM] [Info] 0.713368 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:19, valid_1 auc : 0.610754\n",
      "[LightGBM] [Info] 0.752854 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:20, valid_1 auc : 0.610121\n",
      "[LightGBM] [Info] 0.793621 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:21, valid_1 auc : 0.611113\n",
      "[LightGBM] [Info] 0.832314 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:22, valid_1 auc : 0.61193\n",
      "[LightGBM] [Info] 0.874746 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:23, valid_1 auc : 0.614457\n",
      "[LightGBM] [Info] 0.913204 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:24, valid_1 auc : 0.61465\n",
      "[LightGBM] [Info] 0.954664 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:25, valid_1 auc : 0.615997\n",
      "[LightGBM] [Info] 0.994935 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:26, valid_1 auc : 0.617347\n",
      "[LightGBM] [Info] 1.034625 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:27, valid_1 auc : 0.617179\n",
      "[LightGBM] [Info] 1.073153 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:28, valid_1 auc : 0.617539\n",
      "[LightGBM] [Info] 1.113828 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:29, valid_1 auc : 0.619778\n",
      "[LightGBM] [Info] 1.151697 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:30, valid_1 auc : 0.622314\n",
      "[LightGBM] [Info] 1.190599 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:31, valid_1 auc : 0.622992\n",
      "[LightGBM] [Info] 1.229706 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:32, valid_1 auc : 0.623347\n",
      "[LightGBM] [Info] 1.268238 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:33, valid_1 auc : 0.623533\n",
      "[LightGBM] [Info] 1.307999 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:34, valid_1 auc : 0.625677\n",
      "[LightGBM] [Info] 1.346906 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:35, valid_1 auc : 0.625375\n",
      "[LightGBM] [Info] 1.383665 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:36, valid_1 auc : 0.625818\n",
      "[LightGBM] [Info] 1.421817 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:37, valid_1 auc : 0.626642\n",
      "[LightGBM] [Info] 1.459408 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:38, valid_1 auc : 0.626674\n",
      "[LightGBM] [Info] 1.497056 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:39, valid_1 auc : 0.628723\n",
      "[LightGBM] [Info] 1.533860 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:40, valid_1 auc : 0.631002\n",
      "[LightGBM] [Info] 1.567480 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:41, valid_1 auc : 0.631155\n",
      "[LightGBM] [Info] 1.605781 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:42, valid_1 auc : 0.630567\n",
      "[LightGBM] [Info] 1.639625 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:43, valid_1 auc : 0.630345\n",
      "[LightGBM] [Info] 1.677287 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] Iteration:44, valid_1 auc : 0.630741\n",
      "[LightGBM] [Info] 1.715798 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:45, valid_1 auc : 0.63053\n",
      "[LightGBM] [Info] 1.753242 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:46, valid_1 auc : 0.63269\n",
      "[LightGBM] [Info] 1.793183 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:47, valid_1 auc : 0.632721\n",
      "[LightGBM] [Info] 1.829012 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] Iteration:48, valid_1 auc : 0.632792\n",
      "[LightGBM] [Info] 1.866751 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:49, valid_1 auc : 0.634119\n",
      "[LightGBM] [Info] 1.903245 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:50, valid_1 auc : 0.633721\n",
      "[LightGBM] [Info] 1.940299 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:51, valid_1 auc : 0.633322\n",
      "[LightGBM] [Info] 1.969625 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] Iteration:52, valid_1 auc : 0.634756\n",
      "[LightGBM] [Info] 2.004316 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:53, valid_1 auc : 0.634887\n",
      "[LightGBM] [Info] 2.036555 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=12\n",
      "[LightGBM] [Info] Iteration:54, valid_1 auc : 0.635476\n",
      "[LightGBM] [Info] 2.067632 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] Iteration:55, valid_1 auc : 0.635692\n",
      "[LightGBM] [Info] 2.103242 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:56, valid_1 auc : 0.637175\n",
      "[LightGBM] [Info] 2.137297 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:57, valid_1 auc : 0.636506\n",
      "[LightGBM] [Info] 2.167951 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:58, valid_1 auc : 0.636702\n",
      "[LightGBM] [Info] 2.201925 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:59, valid_1 auc : 0.636852\n",
      "[LightGBM] [Info] 2.229905 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:60, valid_1 auc : 0.637172\n",
      "[LightGBM] [Info] 2.261699 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:61, valid_1 auc : 0.637412\n",
      "[LightGBM] [Info] 2.294442 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:62, valid_1 auc : 0.637025\n",
      "[LightGBM] [Info] 2.331324 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:63, valid_1 auc : 0.637554\n",
      "[LightGBM] [Info] 2.356288 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] Iteration:64, valid_1 auc : 0.637561\n",
      "[LightGBM] [Info] 2.391242 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=12\n",
      "[LightGBM] [Info] Iteration:65, valid_1 auc : 0.637323\n",
      "[LightGBM] [Info] 2.416163 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] Iteration:66, valid_1 auc : 0.637628\n",
      "[LightGBM] [Info] 2.445282 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:67, valid_1 auc : 0.637597\n",
      "[LightGBM] [Info] 2.475580 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:68, valid_1 auc : 0.638254\n",
      "[LightGBM] [Info] 2.507852 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] Iteration:69, valid_1 auc : 0.638454\n",
      "[LightGBM] [Info] 2.532764 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] Iteration:70, valid_1 auc : 0.638639\n",
      "[LightGBM] [Info] 2.564487 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n"
     ]
    }
   ],
   "source": [
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 100,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 70,\n",
    "        bagging_fraction = 1,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 15,\n",
    "        learning_rate = 0.1,\n",
    "        metric = 'auc',\n",
    "        feature_fraction = 0.8,\n",
    "        early_stopping_round=100\n",
    "    )\n",
    "\n",
    "clf.fit(df_train[feat_cols], df_train[label], test_data = [(df_test[feat_cols], df_test[label])])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "[LightGBM] [Info] Iteration:72, valid_1 auc : 0.63864"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Итак, оптимальный классификатор имеет параметры:\n",
    "\n",
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 100,\n",
    "        num_iterations = 70,\n",
    "        bagging_fraction = 1,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 15,\n",
    "        learning_rate = 0.1,\n",
    "        metric = 'auc',\n",
    "        feature_fraction = 0.8        \n",
    "    )\n",
    "    \n",
    "На кросс-валидации дает AUCROC 0.6096, на тесте 0.63864"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n"
     ]
    }
   ],
   "source": [
    "df_test['pred'] = clf.predict_proba(df_test[feat_cols])[:,1]\n",
    "df_test['sample'] = 'test'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "print('Feature importances')\n",
    "print(sorted(zip([e[1] for e in sorted(list(clf.feature_importance().items()))],feat_cols),reverse = 1))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Построение предсказания"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.912096 seconds\n",
      "[LightGBM] [Info] Number of positive: 6218, number of negative: 101701\n",
      "[LightGBM] [Info] Total Bins 8551\n",
      "[LightGBM] [Info] Number of data: 107919, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.029158 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.057248 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.088767 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.118588 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.147126 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.174210 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.202765 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.231335 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.259152 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.287668 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.316180 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.344988 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.372590 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.400818 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.427605 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.457660 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.484720 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.514498 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.542946 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.572065 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.601216 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.631030 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.657254 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.684904 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.713359 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.740436 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.767862 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.799246 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.826969 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.855136 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.882712 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.910850 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.937945 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.965166 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.990351 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.018518 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.045218 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.071018 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.097454 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.124863 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.151437 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.175427 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.202052 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.228269 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.251969 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.275774 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.298590 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.324510 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.346810 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.372766 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.392230 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.417175 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.443158 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=11\n",
      "[LightGBM] [Info] 1.468153 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.497299 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.517958 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.541278 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.564712 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.588304 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.611649 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.633101 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.653703 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.675736 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.699369 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.722321 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.742379 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=12\n",
      "[LightGBM] [Info] 1.765019 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.780523 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.804263 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.820732 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.902787 seconds\n",
      "[LightGBM] [Info] Number of positive: 6236, number of negative: 101682\n",
      "[LightGBM] [Info] Total Bins 8551\n",
      "[LightGBM] [Info] Number of data: 107918, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.029638 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.056361 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.082865 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.118311 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.146882 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.175867 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.202263 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.232632 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.260750 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.290761 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.318209 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.347860 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.378643 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.408430 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.435468 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.465638 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.495327 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.521823 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.550847 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.583215 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.612331 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.644226 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.672848 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.699659 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.726660 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.754498 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.780871 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.808949 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.835281 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.862292 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.888012 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.916541 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.940827 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.970218 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.994511 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.021741 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.046890 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.072954 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.098256 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.123482 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.149400 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.176454 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.197894 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.221992 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.248842 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.276000 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.298735 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.325088 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.347088 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.375485 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.397491 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.423201 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.443927 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.464685 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.484706 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.505917 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.525860 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.549345 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.566390 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.589234 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.608553 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.631127 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.647927 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.671493 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.692954 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.712218 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.732642 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.756074 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.775647 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.796637 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.864644 seconds\n",
      "[LightGBM] [Info] Number of positive: 6261, number of negative: 101658\n",
      "[LightGBM] [Info] Total Bins 8550\n",
      "[LightGBM] [Info] Number of data: 107919, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.027848 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.055581 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.082930 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.110798 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.138872 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.167515 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.194836 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.222507 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.249502 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.278991 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.306667 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.335153 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.361422 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.388625 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.416709 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.444316 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.471621 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.500899 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.532567 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.560031 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.588355 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.619714 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.647600 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.675936 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.703095 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.730795 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.758426 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.785594 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.813048 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.842849 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.870869 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.900620 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.926934 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.957306 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.985956 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.013481 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.035865 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.061128 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.088033 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.113336 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.139649 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.164515 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.192253 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.218532 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.240173 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.266788 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.291646 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.317566 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.340313 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.361236 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.385632 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.405948 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.432387 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.455213 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.476933 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.501003 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.533953 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.556671 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.579642 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.595817 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.615826 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.641128 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.667782 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.688267 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.705963 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.727234 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.746570 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.770750 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.791414 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.814741 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.871280 seconds\n",
      "[LightGBM] [Info] Number of positive: 6326, number of negative: 101592\n",
      "[LightGBM] [Info] Total Bins 8549\n",
      "[LightGBM] [Info] Number of data: 107918, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.027356 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.055294 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.081748 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.111587 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.139415 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.166525 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.193162 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.220276 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.247616 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.276279 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.303229 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.330336 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.357648 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.385427 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.411573 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.440431 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.467291 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.494299 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.525364 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.553412 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.579395 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.609109 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.635204 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.662447 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.690074 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.716066 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.740970 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.768260 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.795090 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.822593 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.847452 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.871656 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.897442 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.924557 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.955917 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.984049 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.009140 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.035447 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.058014 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.084307 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.105532 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.131907 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.157808 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 1.184036 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.209865 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.235144 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.258599 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.281711 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.306461 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.328433 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.351527 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.375684 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.398964 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.423835 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.446962 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.469244 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.494354 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.520671 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.545854 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.564713 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.585976 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.609377 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.632179 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.649608 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.671173 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.691428 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.711554 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.734803 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.758255 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.783683 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading data in 1.849635 seconds\n",
      "[LightGBM] [Info] Number of positive: 6239, number of negative: 101679\n",
      "[LightGBM] [Info] Total Bins 8551\n",
      "[LightGBM] [Info] Number of data: 107918, number of used features: 39\n",
      "[LightGBM] [Info] Finished initializing training\n",
      "[LightGBM] [Info] Started training...\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.027550 seconds elapsed, finished iteration 1\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.053688 seconds elapsed, finished iteration 2\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.079460 seconds elapsed, finished iteration 3\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.107911 seconds elapsed, finished iteration 4\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.134417 seconds elapsed, finished iteration 5\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.162604 seconds elapsed, finished iteration 6\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.187025 seconds elapsed, finished iteration 7\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.212083 seconds elapsed, finished iteration 8\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.238099 seconds elapsed, finished iteration 9\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.266485 seconds elapsed, finished iteration 10\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.291947 seconds elapsed, finished iteration 11\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.318694 seconds elapsed, finished iteration 12\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.347022 seconds elapsed, finished iteration 13\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 0.370564 seconds elapsed, finished iteration 14\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.395958 seconds elapsed, finished iteration 15\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.423642 seconds elapsed, finished iteration 16\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.449241 seconds elapsed, finished iteration 17\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.475902 seconds elapsed, finished iteration 18\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.503485 seconds elapsed, finished iteration 19\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.529946 seconds elapsed, finished iteration 20\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.558520 seconds elapsed, finished iteration 21\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.587406 seconds elapsed, finished iteration 22\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.612987 seconds elapsed, finished iteration 23\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.637073 seconds elapsed, finished iteration 24\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.664622 seconds elapsed, finished iteration 25\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.689996 seconds elapsed, finished iteration 26\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.715954 seconds elapsed, finished iteration 27\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.742701 seconds elapsed, finished iteration 28\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.768504 seconds elapsed, finished iteration 29\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.794588 seconds elapsed, finished iteration 30\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.821493 seconds elapsed, finished iteration 31\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=5\n",
      "[LightGBM] [Info] 0.848432 seconds elapsed, finished iteration 32\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.873243 seconds elapsed, finished iteration 33\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 0.901012 seconds elapsed, finished iteration 34\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 0.924520 seconds elapsed, finished iteration 35\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 0.950744 seconds elapsed, finished iteration 36\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 0.977156 seconds elapsed, finished iteration 37\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.001101 seconds elapsed, finished iteration 38\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.026547 seconds elapsed, finished iteration 39\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.052307 seconds elapsed, finished iteration 40\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.077238 seconds elapsed, finished iteration 41\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.101638 seconds elapsed, finished iteration 42\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=6\n",
      "[LightGBM] [Info] 1.128710 seconds elapsed, finished iteration 43\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.151761 seconds elapsed, finished iteration 44\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.176734 seconds elapsed, finished iteration 45\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.204314 seconds elapsed, finished iteration 46\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.227651 seconds elapsed, finished iteration 47\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.253656 seconds elapsed, finished iteration 48\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.277794 seconds elapsed, finished iteration 49\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.297959 seconds elapsed, finished iteration 50\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.324479 seconds elapsed, finished iteration 51\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.356215 seconds elapsed, finished iteration 52\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.391994 seconds elapsed, finished iteration 53\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.426841 seconds elapsed, finished iteration 54\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.447862 seconds elapsed, finished iteration 55\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.469683 seconds elapsed, finished iteration 56\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.493644 seconds elapsed, finished iteration 57\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.517418 seconds elapsed, finished iteration 58\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.541183 seconds elapsed, finished iteration 59\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.561502 seconds elapsed, finished iteration 60\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.584029 seconds elapsed, finished iteration 61\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.607783 seconds elapsed, finished iteration 62\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=10\n",
      "[LightGBM] [Info] 1.628738 seconds elapsed, finished iteration 63\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.650205 seconds elapsed, finished iteration 64\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.673152 seconds elapsed, finished iteration 65\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=7\n",
      "[LightGBM] [Info] 1.692267 seconds elapsed, finished iteration 66\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.709190 seconds elapsed, finished iteration 67\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=8\n",
      "[LightGBM] [Info] 1.729392 seconds elapsed, finished iteration 68\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.747306 seconds elapsed, finished iteration 69\n",
      "[LightGBM] [Info] Trained a tree with leaves=15 and max_depth=9\n",
      "[LightGBM] [Info] 1.767660 seconds elapsed, finished iteration 70\n",
      "[LightGBM] [Info] Finished training\n",
      "[LightGBM] [Info] Finished loading parameters\n",
      "[LightGBM] [Info] Finished loading 71 models\n",
      "[LightGBM] [Info] Finished initializing prediction\n",
      "[LightGBM] [Info] Finished prediction\n"
     ]
    }
   ],
   "source": [
    "clf = GBMClassifier(\n",
    "        exec_path=exec_path,\n",
    "        min_data_in_leaf = 100,\n",
    "       # is_unbalance = True,\n",
    "        num_iterations = 70,\n",
    "        bagging_fraction = 1,\n",
    "        bagging_freq = 10,\n",
    "        num_leaves = 15,\n",
    "        learning_rate = 0.1,\n",
    "        metric = 'auc',\n",
    "        feature_fraction = 0.8,\n",
    "    )\n",
    "\n",
    "r = cv(clf, df_train[feat_cols].values, df_train[label].values, folds = 5, metrics = 'roc_auc,pr_auc', predict = True)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.61002521499472562"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "sklearn.metrics.roc_auc_score(y_score = r[1], y_true = df_train[label].values)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "df_train['pred'] = r[1]\n",
    "df_train['sample'] = 'train'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "df_all = (\n",
    "      hc.sql('select * from user_kposminin.cred_app_sc_4')\n",
    "        .filter('(call_ymd > \"2016-06-01\") or (default_flg is Null)')\n",
    "        .map(lambda r: \n",
    "                list(r[:9]) + (r[9] if r[9] else []) + list(r[10:-2])  + (r[-2] if r[-2] else []) + (r[-1] if r[-1] else [])\n",
    "            )\n",
    "        .toDF()\n",
    "        .toPandas()\n",
    "    )\n",
    "df_all.columns = cols\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((178601, 47), (134898, 47), (43703, 47))"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_all = df_train.append(df_test, ignore_index= True)\n",
    "df_all.shape,df_train.shape,df_test.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "df_all.to_csv('data/default_predict_result.csv',index = False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {
    "collapsed": false
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "80M\tdata/default_predict_result.csv\r\n"
     ]
    }
   ],
   "source": [
    "! du -h data/default_predict_result.csv"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Сохранить в Hive"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": false
   },
   "outputs": [],
   "source": [
    "hc.registerDataFrameAsTable(hc.createDataFrame(df_all), 'df_all')\n",
    "hc.sql('drop table if exists user_kposminin.default_predict_result')\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "hc.sql('create table user_kposminin.default_predict_result as select * from df_all')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Тематическое моделирование BigARTM (еще не доделано)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": [
    "query = '''\n",
    "\n",
    "-- Статистика урлфрагментов на обучающей выборке\n",
    "create table user_kposminin.cred_app_urlfr_stat as \n",
    "select\n",
    "  urlfr,\n",
    "  count(distinct phone_mobile,call_ymd) as visitors_cnt\n",
    "from\n",
    "  user_kposminin.cred_app_visits\n",
    "  where call_ymd < '2017-06-01'\n",
    "group by urlfr\n",
    ";\n",
    "\n",
    "\n",
    "\n",
    "-- Формирование данных для BigARTM в задача cred_scoring\n",
    "create table user_kposminin.cred_app_features_4_thematic_modelling as\n",
    "select\n",
    "  phone_mobile, \n",
    "  call_ymd, \n",
    "  concat_ws(' ',collect_list(concat(urlfr,':',hits))) as feat_hits,\n",
    "  concat_ws(' ',collect_list(concat(urlfr,':',cnt))) as feat_cnt,\n",
    "  concat_ws(' ',collect_list(concat(urlfr,':',1))) as feat_1,\n",
    "  concat_ws(' ',collect_list(concat(urlfr,':',ymd_cnt))) as feat_ymd,\n",
    "  sum(hits) as hits,\n",
    "  sum(cnt) as cnt,\n",
    "  max(ymd_cnt) as max_ymd_cnt\n",
    "  \n",
    "from\n",
    "  (select \n",
    "    phone_mobile, \n",
    "    call_ymd, \n",
    "    max(default_flg) as default_flg,\n",
    "    v.urlfr,\n",
    "    count(*) as cnt,\n",
    "    count(distinct ymd) as ymd_cnt,\n",
    "    sum(cnt) as hits\n",
    "  from user_kposminin.cred_app_visits v\n",
    "  left join user_kposminin.cred_app_urlfr_stat st on st.urlfr = v.urlfr\n",
    "  where coalesce(st.visitors_cnt,1000) > 300\n",
    "  group by \n",
    "    phone_mobile, \n",
    "    call_ymd, \n",
    "    v.urlfr\n",
    "  order by \n",
    "    phone_mobile, \n",
    "    call_ymd, \n",
    "    v.urlfr\n",
    "  ) a  \n",
    "group by \n",
    "  phone_mobile, \n",
    "  call_ymd\n",
    ";\n",
    "\n",
    "\n",
    "\n",
    "'''"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 2",
   "language": "python",
   "name": "python2"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.13"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
