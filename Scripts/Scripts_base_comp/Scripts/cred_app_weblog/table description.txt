ФОРМАТ:

phone_num (string) - номер телефона
call_ymd (string) - дата звонка
url (string) - посещенный урл. NB Вместе с http:\\, https:\\ и т.д.
cnt (int) - счетчик посещений этого урла в данный день
min_time (int) - минимальное время просмотра урла в этот день в минутах от начала дня
max_time (int) - максимальное время просмотра урла в этот день в минутах от начала дня
ymd (string) - день просмотра

Для каждого номера берется глубина полгода до даты звонка (не включая дату звонка) (e



create table user_kposminin.cred_scoring_urls_2 as 
select
  url,count(distinct phone_num) as phone_num_cnt
from
  user_kposminin.cred_scoring_weblog
group by
  url
having
  phone_num_cnt > 5
;


create table user_kposminin.cred_scoring_distinct_urls as 
select url
from user_kposminin.cred_scoring_urls_2
where phone_num_cnt >= 25
;


create table user_kposminin.cred_scoring_weblog_2 as
select
  a.phone_num,
  a.call_ymd,
  b.approve,
  a.url,
  a.cnt,
  a.min_time,
  a.max_time,
  a.ymd
from
  user_kposminin.cred_scoring_weblog a
  inner join user_kposminin.aza_to_liru_risk_l170131 b on substr(b.phone_mobile, 2, 15) = substr(a.phone_num, 3, 15) and to_date(b.create_dt) = a.call_ymd
;
