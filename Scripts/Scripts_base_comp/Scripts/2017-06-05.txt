insert overwrite table prod_features_liveinternet.urlfr_scores partition (ymd, target)
select
  urlfr, positive, total, score, ymd, target
from
  user_kposminin.urlfr_scores
where
  target = 'ccall_tinkoff_approve_from_fullapp'
  and ymd = '2016-12-01'
;

insert overwrite table prod_features_liveinternet.urlfr_scores partition (ymd, target)
select
  urlfr, positive, total, score, ymd, target
from
  user_kposminin.urlfr_scores
where
  target = 'tinkoff_LON_CCR_default'
  and ymd = '2017-01-01'
;

insert overwrite table prod_features_liveinternet.urlfr_scores partition (ymd, target)
select
  urlfr, positive, total, score, '2017-03-05' as ymd, target
from
  user_kposminin.urlfr_scores
where
  target = 'tinkoff_platinum_approved_application03@tinkoff_action'
  and ymd = '00 but actually its from 2017-03-05'
;

insert overwrite table prod_features_liveinternet.urlfr_scores partition (ymd, target)
select
  urlfr, positive, total, score, '2017-03-05' as ymd, target
from
  user_kposminin.urlfr_scores
where
  target = 'tinkoff_platinum_complete_application03@tinkoff_action'
  and ymd = '00 but actually its from 2017-03-05'
;

insert overwrite table prod_features_liveinternet.urlfr_scores partition (ymd, target)
select
  urlfr, positive, total, score, ymd, target
from
  user_kposminin.urlfr_scores
where
  target = 'tinkoff_platinum_approved_application03_1m'
  and ymd = '2017-03-01'
;

insert overwrite table prod_features_liveinternet.urlfr_scores partition (ymd, target)
select
  urlfr, positive, total, score, ymd, target
from
  user_kposminin.urlfr_scores
where
  target = 'tinkoff_platinum_complete_application03_1m'
  and ymd = '2017-03-01'
;





CREATE TABLE `prod_lookalike.urlfr_scores`(
	  `urlfr` string, 
	  `positive` bigint, 
	  `total` bigint, 
	  `score` double,
      `frame_size` int)
	PARTITIONED BY ( 
	  `ymd` string, 
	  `target` string)
;


insert overwrite TABLE `prod_lookalike.urlfr_scores` partition (ymd,target)
select 
  urlfr,
  positive,
  total,
  score,
  30 as frame_size,
  ymd,
  target
from 
  prod_features_liveinternet.urlfr_scores
where not target = 	'tinkoff_platinum_complete_application@tinkoff_actions'
and target like 'tinkoff_platinum%'
;


insert overwrite TABLE `prod_lookalike.urlfr_scores` partition (ymd,target)
select 
  urlfr,
  positive,
  total,
  score,
  365 as frame_size,
  ymd,
  target
from 
  prod_features_liveinternet.urlfr_scores
where target in ('tinkoff_LON_CCR_default','ccall_tinkoff_approve_from_fullapp')
;






insert overwrite TABLE `prod_lookalike.urlfr_scores` partition (ymd,target)
select 
  urlfr,
  Null as positive,
  Null as total,
  score,
  Null as frame_size,
  Null as ymd,
  segment_nm as target
from 
  prod_lookalike.urlfr_coeff

;


-- в итоге лучше не делать.



